"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.imageDimensionsPlugin=void 0;const pluginDefaults={container:"",image:"",loading:"lazy",decode:false,removeSource:false};const imageDimensionsPlugin=(md,pluginOpts=pluginDefaults)=>{if(pluginOpts&&pluginOpts.container&&pluginOpts.container.length>0){md.renderer.rules.paragraph_open=(tokens,idx,options,env,self)=>{const currentToken=tokens[idx];const nextToken=tokens[idx+1];if(tokens[idx+1].type==="inline"&&nextToken.children&&nextToken.children.some((child=>child.type==="image"))){currentToken.attrSet("class",pluginOpts.container);return self.renderToken(tokens,idx,options)}return self.renderToken(tokens,idx,options)}}md.renderer.rules.image=(tokens,idx,options,env,self)=>{var _a,_b,_c,_d,_e,_f;const token=tokens[idx];const attrs=(_a=token.attrs)!==null&&_a!==void 0?_a:[];const alt=token.content;const srcAttr=attrs.find((attr=>attr[0]==="src"));const titleAttr=attrs.find((attr=>attr[0]==="title"));const src=(_b=srcAttr===null||srcAttr===void 0?void 0:srcAttr[1])!==null&&_b!==void 0?_b:"";const title=(_c=titleAttr===null||titleAttr===void 0?void 0:titleAttr[1])!==null&&_c!==void 0?_c:"";const params=new URLSearchParams((_d=src.split("?")[1])!==null&&_d!==void 0?_d:"");const width=(_e=params.get("width"))!==null&&_e!==void 0?_e:"100%";const height=(_f=params.get("height"))!==null&&_f!==void 0?_f:"100%";const widthIsPercentage=width.includes("%");const heightIsPercentage=height.includes("%");const replacedSrc=src.replace(/[\?&](width|height)=\S+&?/g,"");const attributes=[["src",pluginOpts.removeSource?"":replacedSrc],["loading",pluginOpts.loading],["decoding",pluginOpts.decode?"async":""],["data-src",replacedSrc],["alt",alt],["title",title],["class",pluginOpts.image||""],["width",widthIsPercentage?width:`${width}px`],["height",heightIsPercentage?height:`${height}px`]];if(pluginOpts.removeSource){attributes.push(["style",`display: block; width: ${width==="100%"?"100%":widthIsPercentage?width:`${width}px`}; height: ${height==="100%"?"100%":heightIsPercentage?height:`${height}px`}; background-color: #ccc;`])}token.attrs=attributes.filter((attribute=>attribute[1]!==""));return self.renderToken(tokens,idx,options)}};exports.imageDimensionsPlugin=imageDimensionsPlugin;